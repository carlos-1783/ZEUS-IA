import{u as x,a as E,_ as D}from"./index-a14903ab.js";import{d as F,e as _,A as m,h,o as S,q as O,c as l,k as t,n as y,t as i,E as u,F as A,s as B,l as C,b as d}from"./vendor-f1ee3dc2.js";const I={class:"websocket-test"},J={class:"connection-status"},L=["disabled"],U=["disabled"],P={class:"message-log"},V={class:"log-entries"},q={class:"timestamp"},z={class:"message"},j={key:0,class:"error"},G={key:0,class:"token-info"},H={class:"token-preview"},K=F({__name:"WebSocketTest",setup(Q){const n=x(),p=_([]),{status:v,isConnected:a,connect:f,disconnect:b,error:T}=E(),r=_(null);m(v,e=>{e==="connected"&&!r.value?r.value=new WebSocket(`ws://localhost:8000/ws?token=${n.token}`):(e==="disconnected"||e==="error")&&(r.value=null),e==="connected"?o("WebSocket connected successfully","info"):e==="disconnected"?o("WebSocket disconnected","info"):e==="error"&&o("WebSocket connection error","error")});const k=_(!1),W=h(()=>({"status-connected":a.value,"status-connecting":k.value,"status-disconnected":!a.value&&!k.value})),M=h(()=>{if(!n.token)return"No token available";const e=n.token;return`${e.substring(0,15)}...${e.substring(e.length-15)}`}),o=(e,s="info",c)=>{const g={type:s,message:e,timestamp:new Date().toISOString().split("T")[1].split(".")[0],error:c instanceof Error?c.message:String(c)};p.value.unshift(g)},N=()=>{a.value?b():f(n.token)},$=()=>{if(!a.value||!r.value){o("Not connected to WebSocket server","error");return}const e={type:"test",data:"This is a test message",timestamp:new Date().toISOString()};try{r.value.send(JSON.stringify(e)),o(`Sent: ${JSON.stringify(e)}`,"sent")}catch(s){o("Failed to send message","error",s)}},w=async()=>{if(n.token)try{await navigator.clipboard.writeText(n.token),o("Token copied to clipboard","info")}catch(e){o("Failed to copy token","error",e)}};return m(T,e=>{e&&o(`Error: ${e.message}`,"error")}),S(()=>{f(n.token)}),O(()=>{b()}),S(()=>{n.isAuthenticated?o("User is authenticated, ready to connect","info"):o("User is not authenticated. Please log in to test WebSocket connection.","error")}),(e,s)=>(d(),l("div",I,[s[3]||(s[3]=t("h1",null,"WebSocket Connection Test",-1)),t("div",J,[s[0]||(s[0]=t("h3",null,"Connection Status:",-1)),t("div",{class:y(["status-indicator",W.value])},i(u(v)),3),t("button",{onClick:N,disabled:k.value,class:"connect-btn"},i(u(a)?"Disconnect":"Connect"),9,L),t("button",{onClick:$,disabled:!u(a),class:"test-btn"}," Send Test Message ",8,U)]),t("div",P,[s[1]||(s[1]=t("h3",null,"Message Log:",-1)),t("div",V,[(d(!0),l(A,null,B(p.value,(c,g)=>(d(),l("div",{key:g,class:y(["log-entry",c.type])},[t("span",q,"["+i(c.timestamp)+"]",1),t("span",z,i(c.message),1),c.error?(d(),l("span",j,"Error: "+i(c.error),1)):C("",!0)],2))),128))])]),u(n).token?(d(),l("div",G,[s[2]||(s[2]=t("h3",null,"JWT Token:",-1)),t("div",H,i(M.value),1),t("button",{onClick:w,class:"copy-btn"}," Copy Token ")])):C("",!0)]))}});const Y=D(K,[["__scopeId","data-v-b8d2871e"]]);export{Y as default};
