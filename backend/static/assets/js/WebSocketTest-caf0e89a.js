import{u as x,a as B,_ as D}from"./index-37ed2969.js";import{p as E,r as p,q as b,c as h,s as S,v as F,b as l,e as t,n as y,t as i,A as u,F as O,B as A,g as C,o as d}from"./vendor-54a30993.js";import"./three-c4693b27.js";const I={class:"websocket-test"},J={class:"connection-status"},L=["disabled"],U=["disabled"],P={class:"message-log"},V={class:"log-entries"},q={class:"timestamp"},z={class:"message"},j={key:0,class:"error"},G={key:0,class:"token-info"},H={class:"token-preview"},K=E({__name:"WebSocketTest",setup(Q){const n=x(),_=p([]),{status:v,isConnected:a,connect:f,disconnect:m,error:T}=B(),r=p(null);b(v,e=>{e==="connected"&&!r.value?r.value=new WebSocket(`ws://localhost:8000/api/v1/ws/ws?token=${n.token}`):(e==="disconnected"||e==="error")&&(r.value=null),e==="connected"?o("WebSocket connected successfully","info"):e==="disconnected"?o("WebSocket disconnected","info"):e==="error"&&o("WebSocket connection error","error")});const k=p(!1),W=h(()=>({"status-connected":a.value,"status-connecting":k.value,"status-disconnected":!a.value&&!k.value})),w=h(()=>{if(!n.token)return"No token available";const e=n.token;return`${e.substring(0,15)}...${e.substring(e.length-15)}`}),o=(e,s="info",c)=>{const g={type:s,message:e,timestamp:new Date().toISOString().split("T")[1].split(".")[0],error:c instanceof Error?c.message:String(c)};_.value.unshift(g)},M=()=>{a.value?m():f(n.token)},N=()=>{if(!a.value||!r.value){o("Not connected to WebSocket server","error");return}const e={type:"test",data:"This is a test message",timestamp:new Date().toISOString()};try{r.value.send(JSON.stringify(e)),o(`Sent: ${JSON.stringify(e)}`,"sent")}catch(s){o("Failed to send message","error",s)}},$=async()=>{if(n.token)try{await navigator.clipboard.writeText(n.token),o("Token copied to clipboard","info")}catch(e){o("Failed to copy token","error",e)}};return b(T,e=>{e&&o(`Error: ${e.message}`,"error")}),S(()=>{f(n.token)}),F(()=>{m()}),S(()=>{n.isAuthenticated?o("User is authenticated, ready to connect","info"):o("User is not authenticated. Please log in to test WebSocket connection.","error")}),(e,s)=>(d(),l("div",I,[s[3]||(s[3]=t("h1",null,"WebSocket Connection Test",-1)),t("div",J,[s[0]||(s[0]=t("h3",null,"Connection Status:",-1)),t("div",{class:y(["status-indicator",W.value])},i(u(v)),3),t("button",{onClick:M,disabled:k.value,class:"connect-btn"},i(u(a)?"Disconnect":"Connect"),9,L),t("button",{onClick:N,disabled:!u(a),class:"test-btn"}," Send Test Message ",8,U)]),t("div",P,[s[1]||(s[1]=t("h3",null,"Message Log:",-1)),t("div",V,[(d(!0),l(O,null,A(_.value,(c,g)=>(d(),l("div",{key:g,class:y(["log-entry",c.type])},[t("span",q,"["+i(c.timestamp)+"]",1),t("span",z,i(c.message),1),c.error?(d(),l("span",j,"Error: "+i(c.error),1)):C("",!0)],2))),128))])]),u(n).token?(d(),l("div",G,[s[2]||(s[2]=t("h3",null,"JWT Token:",-1)),t("div",H,i(w.value),1),t("button",{onClick:$,class:"copy-btn"}," Copy Token ")])):C("",!0)]))}});const Z=D(K,[["__scopeId","data-v-b8d2871e"]]);export{Z as default};
