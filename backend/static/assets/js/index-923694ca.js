import{r as S,a as ae,i as J,d as ie,c as L,j as O,b as N,e as f,f as b,w as q,n as K,t as z,g as ce,u as ue,h as $,o as U,k as D,l as le,m as de,p as he,q as fe,s as me}from"./vendor-b50a21e2.js";const pe=function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),_e=function(e){return"/"+e},Z={},k=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=_e(n),n in Z)return;Z[n]=!0;const a=n.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(!!o)for(let h=s.length-1;h>=0;h--){const v=s[h];if(v.href===n&&(!a||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${d}`))return;const w=document.createElement("link");if(w.rel=a?"stylesheet":pe,a||(w.as="script",w.crossOrigin=""),w.href=n,document.head.appendChild(w),a)return new Promise((h,v)=>{w.addEventListener("load",h),w.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t()).catch(n=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n})},we=e=>{if(!e||typeof e!="string"||e.trim()==="")return null;const t=ge(e);if(!t)return null;try{const r=t.split(".");if(r.length!==3)return null;const o=r[1],n=o.padEnd(o.length+(4-o.length%4)%4,"=").replace(/\-/g,"+").replace(/_/g,"/");try{const a=decodeURIComponent(atob(n).split("").map(p=>"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)).join("")),d=JSON.parse(a);if(d&&typeof d=="object"&&"exp"in d){const p=d.exp}return d}catch{return null}}catch{return null}};S(!1);const ge=e=>{if(!e)return null;try{let t=String(e).replace(/[\u0000-\u001F\u007F-\u009F\u2000-\u200F\u2028-\u202F\u205F-\u206F\u3000\uFEFF]/g,"").trim();if(t=t.replace(/^[^a-zA-Z0-9]*bearer[^a-zA-Z0-9]*(.*)/i,(o,s)=>s||"").trim(),!t)return null;const r=t.split(".");if(r.length!==3)return null;try{r.forEach(o=>{const s=o.padEnd(o.length+(4-o.length%4)%4,"=");atob(s)})}catch{return null}return t}catch{return null}},x="auth_token",I="refresh_token",H="refresh_timeout",j="Bearer ",u={setToken:e=>{if(e)try{localStorage.setItem(x,e),l.defaults.headers.common.Authorization=`${j}${e}`}catch{}else localStorage.removeItem(x),delete l.defaults.headers.common.Authorization},getToken:()=>typeof window>"u"?null:localStorage.getItem(x),setRefreshToken:e=>{if(e)try{localStorage.setItem(I,e)}catch{}else localStorage.removeItem(I)},getRefreshToken:()=>typeof window>"u"?null:localStorage.getItem(I),removeTokens:()=>{localStorage.removeItem(x),localStorage.removeItem(I),localStorage.removeItem(H),delete l.defaults.headers.common.Authorization,window.tokenRefreshTimeout&&(clearTimeout(window.tokenRefreshTimeout),delete window.tokenRefreshTimeout)},removeToken:()=>{localStorage.removeItem(x),delete l.defaults.headers.common.Authorization},isTokenExpired:e=>{if(!e)return!0;try{const t=we(e);if(!t?.exp)return!0;const r=Date.now()/1e3;return t.exp<r}catch{return!0}},isValidToken:e=>e?e.split(".").length===3&&!u.isTokenExpired(e):!1,clearTokens:()=>{localStorage.removeItem(x),localStorage.removeItem(I),localStorage.removeItem(H),delete l.defaults.headers.common.Authorization,window.tokenRefreshTimeout&&(clearTimeout(window.tokenRefreshTimeout),delete window.tokenRefreshTimeout)},getTokenPayload:e=>{if(!e)return null;try{const t=e.split(".");if(t.length!==3)return null;const r=t[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(r).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch{return null}},refreshToken:function(){throw new Error("Function not implemented.")}},l=ae.create({baseURL:"https://zeus-ia-production-16d8.up.railway.app/api/v1",timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"});l.interceptors.request.use(e=>{const t=u.getToken();return t&&(e.headers.Authorization=`${j}${t}`),e.headers["Access-Control-Allow-Origin"]=window.location.origin,e.headers["Access-Control-Allow-Methods"]="GET, POST, PUT, DELETE, OPTIONS",e.headers["Access-Control-Allow-Headers"]="Content-Type, Authorization, X-Requested-With",e.method?.toLowerCase()==="options"&&(e.headers["Access-Control-Max-Age"]="86400"),e},e=>Promise.reject(e));l.interceptors.request.use(e=>{const t=e.url?.includes("auth/login")||e.url?.includes("auth/refresh-token"),r=u.getToken();return r&&!t&&(e.headers.Authorization=`Bearer ${r}`),e.method?.toLowerCase()==="get"&&(e.params={...e.params,_t:Date.now()}),e},e=>Promise.reject(e));const ke=async()=>{const e=u.getRefreshToken();if(!e)return u.clearTokens(),!1;try{const t=await l.post("auth/refresh-token",{refresh_token:e},{skipAuthRefresh:!0});if(t.data.status==="success"&&t.data.data){const{access_token:r,refresh_token:o}=t.data.data;return u.setToken(r),o&&u.setRefreshToken(o),!0}return!1}catch{return u.clearTokens(),!1}};l.interceptors.response.use(e=>e,async e=>{const t=e.config;if(!e.response)return Promise.reject(m("network_error","Error de red",e));if(e.response?.status!==401||t._retry)return Promise.reject(e);if(t._retry=!0,await ke()){const o=u.getToken();if(o)return t.headers.Authorization=`Bearer ${o}`,l(t)}return Promise.reject(e)});const Q=e=>{if(window.tokenRefreshTimeout!==void 0){const r=window.tokenRefreshTimeout;clearTimeout(r),window.tokenRefreshTimeout=void 0}const t=Math.max(e-300,60)*1e3;window.tokenRefreshTimeout=window.setTimeout(async()=>{try{const r=u.getRefreshToken();r?await ee.refreshToken(r):u.removeTokens()}catch{u.removeTokens(),window.dispatchEvent(new Event("unauthorized"))}},t)},G=async e=>{if(!e)throw new Error("No refresh token provided");try{const t=await l.post("auth/refresh-token",{refresh_token:e},{skipAuthRefresh:!0});if(t.data.status==="success"&&t.data.data){const{access_token:r,refresh_token:o,expires_in:s}=t.data.data;if(u.setToken(r),o&&u.setRefreshToken(o),s){const n=Math.max(s-300,60);Q(n)}return t.data.data}throw new Error(t.data.error||"Failed to refresh token")}catch(t){throw J(t)&&t.response?.status===401&&(u.removeTokens(),window.dispatchEvent(new Event("unauthorized"))),t}};l.interceptors.request.use(e=>{if(e.url?.includes("auth/"))return e;const t=u.getToken();return t&&(e.headers.Authorization=`${j}${t}`),e.method?.toLowerCase()==="get"&&(e.params={...e.params,_t:Date.now()}),e},e=>Promise.reject(e));l.interceptors.response.use(e=>(e.config.url?.includes("auth/"),e),async e=>{const t=e.config;if(!e.response)return Promise.reject(m("network_error","Network error",e));const{status:r,data:o}=e.response;if(r===401&&!t._retry){if(t.url?.includes("auth/login")||t.url?.includes("auth/refresh-token"))return Promise.reject(m("auth_error","Invalid credentials",e,o));t._retry=!0;try{const s=u.getRefreshToken();if(!s)return u.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(m("no_refresh_token","Session expired",e));try{const n=await G(s);if(n.access_token)return t.headers=t.headers||{},t.headers.Authorization=`${j}${n.access_token}`,l(t)}catch(n){return u.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(m("token_refresh_failed","Session refresh failed",n))}}catch(s){return u.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(m("token_refresh_failed","Session refresh failed",s))}}switch(r){case 400:return Promise.reject(m("bad_request","Bad request",e,o));case 403:return u.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(m("forbidden","Forbidden",e,o));case 404:return Promise.reject(m("not_found","Resource not found",e,o));case 422:return Promise.reject(m("validation_error","Validation error",e,o));case 429:return Promise.reject(m("too_many_requests","Too many requests",e,o));case 500:return Promise.reject(m("server_error","Internal server error",e,o));case 503:return Promise.reject(m("service_unavailable","Service unavailable",e,o));default:return Promise.reject(m("api_error","API request failed",e,o))}});const ee={login:async e=>{const t=new FormData;t.append("username",e.username),t.append("password",e.password),t.append("grant_type","password");const r=await l.post("auth/login",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(r.data&&r.data.access_token){const{access_token:o,refresh_token:s,expires_in:n}=r.data;if(u.setToken(o),s&&u.setRefreshToken(s),n){const a=Math.max(n-300,60);Q(a)}return r.data}throw new Error(r.data?.detail||"Login failed")},logout:async()=>{try{const e=u.getRefreshToken();e&&await l.post("auth/logout",{refresh_token:e})}catch{}finally{u.removeTokens(),window.location.href="/login"}},refreshToken:G,getCurrentUser:async()=>{const e=await l.get("auth/me");if(e.data&&e.data.data)return e.data.data;throw new Error(e.data?.detail||"Failed to fetch user profile")},getSystemStatus:async()=>{const e=await l.get("/system/status");if(e.data.status==="success"&&e.data.data)return e.data.data;throw new Error(e.data.error||"Failed to fetch system status")},request:async e=>{const t=await l.request(e);if(t.data.status==="success")return t.data.data;throw new Error(t.data.error||"API request failed")}};function m(e,t,r,o){const s=new Error(t);return s.code=e,s.originalError=r,s.details=o,J(r)&&(s.status=r.response?.status,s.statusText=r.response?.statusText),s}const P="auth_token",C="refresh_token",ve=e=>"error"in e||"detail"in e,W=e=>"access_token"in e,y=ee,te=ie("auth",()=>{const e=S(localStorage.getItem(P)),t=S(localStorage.getItem(C)),r=S(null),o=S(!1),s=S(null),n=L(()=>!!e.value),a=L(()=>!!r.value?.is_superuser);function d(){return e.value||localStorage.getItem(P)}function p(){return t.value||localStorage.getItem(C)}function w(i){try{if(!i.access_token||!i.refresh_token)throw new Error("Invalid tokens provided");return e.value=i.access_token,t.value=i.refresh_token,localStorage.setItem(P,i.access_token),localStorage.setItem(C,i.refresh_token),y.setAuthToken&&y.setAuthToken(i.access_token),!0}catch{return h(),!1}}function h(){e.value=null,t.value=null,r.value=null,s.value=null,localStorage.removeItem(P),localStorage.removeItem(C)}function v(i){try{if(!i)return!1;const c=O(i);return r.value={id:c.sub,email:c.email||"",name:c.name||"User",is_active:c.is_active||!1,is_superuser:c.is_superuser||!1},!0}catch{return h(),!1}}async function oe(i,c){if(o.value=!0,s.value=null,h(),!i||!c)return o.value=!1,{success:!1,error:"Email and password are required"};try{if(typeof localStorage>"u")throw new Error("localStorage is not available");const T="__auth_test__";try{localStorage.setItem(T,"test"),localStorage.removeItem(T)}catch{throw new Error("Could not access local storage")}const _=await y.login({username:i.trim(),password:c});if(ve(_)){const g=_.error||_.detail||"Credenciales inválidas";throw new Error(g)}if(!W(_)){const g="Formato de respuesta inválido";throw new Error(g)}if(!_||typeof _!="object"){const g="Invalid server response format";throw new Error(g)}if(!W(_)){const g="Invalid response format: missing access_token";throw new Error(g)}const A=_;try{const g=O(A.access_token),R={access_token:A.access_token,refresh_token:A.refresh_token||"",expires_in:A.expires_in||3600,token_type:A.token_type||"Bearer"};if(R.refresh_token,!w(R))throw new Error("Failed to save tokens");if(v(R.access_token),!localStorage.getItem(P))throw new Error("Could not verify saved token");return{success:!0,message:"Login successful",access_token:R.access_token,refresh_token:R.refresh_token,expires_in:R.expires_in}}catch{throw h(),new Error("Invalid or corrupted token")}}catch(T){const _=T.message||"Login failed";return s.value=_,h(),{success:!1,error:_}}finally{o.value=!1}}async function M(){try{if(e.value)try{await y.logout()}catch{}h()}catch(i){throw h(),i}}async function se(){const i=p();if(!i||o.value)return!1;o.value=!0;try{const c=await y.refreshToken(i);if(c.access_token){if(!w({access_token:c.access_token,refresh_token:c.refresh_token||i,expires_in:c.expires_in,token_type:c.token_type||"Bearer"}))throw new Error("Failed to update tokens after refresh");return v(c.access_token),!0}else throw new Error("Invalid token refresh response")}catch(c){return c instanceof Error&&(c.message.includes("401")||c.message.includes("invalid_grant")||c.message.includes("invalid_token")||c.message.includes("Network error"))&&await M(),!1}finally{o.value=!1}}let F=!1,E=!1;async function ne(){if(E)return n.value;if(F)return!1;F=!0;try{const i=d(),c=p();if(!i||!c)return E=!0,!1;y.setAuthToken&&y.setAuthToken(i);const T=O(i),_=Math.floor(Date.now()/1e3);if(T.exp?T.exp<_:!0)return h(),E=!0,!1;e.value=i,t.value=c;try{return v(i),E=!0,!0}catch{return E=!0,!0}}catch{return E=!0,!1}finally{F=!1}}return{token:e,refreshToken:t,user:r,isLoading:o,error:s,isAuthenticated:n,isAdmin:a,login:oe,logout:M,initialize:ne,refreshAccessToken:se,resetAuthState:h,getToken:d,getRefreshToken:p,updateUserFromToken:v,setAuthTokens:w}});const re=(e,t)=>{const r=e.__vccOpts||e;for(const[o,s]of t)r[o]=s;return r},Te={class:"min-h-screen flex flex-col bg-gray-50"},ye={class:"bg-white shadow-sm"},Ee={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Ae={class:"flex justify-between items-center"},Re={class:"flex-shrink-0"},xe={class:"text-2xl font-bold text-indigo-600"},Se={class:"hidden md:flex space-x-8"},Ie={class:"flex-grow flex items-center justify-center p-4"},Pe={class:"w-full max-w-md"},be={class:"bg-white p-8 rounded-lg shadow-md"},Ce={class:"text-center mb-8"},Le={class:"text-2xl font-bold text-gray-900"},je={key:0,class:"mt-2 text-sm text-gray-600"},Fe={class:"bg-white border-t border-gray-200"},Oe={class:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},qe={class:"text-center text-sm text-gray-500"},ze={__name:"AuthLayout",setup(e){const t=ue(),r=L(()=>t.meta.title||"Bienvenido a ZEUS-IA"),o=L(()=>t.meta.description||"");return(s,n)=>{const a=$("router-link"),d=$("router-view");return U(),N("div",Te,[f("header",ye,[f("div",Ee,[f("div",Ae,[f("div",Re,[f("h1",xe,[b(a,{to:"/"},{default:q(()=>n[0]||(n[0]=[D("ZEUS-IA")])),_:1,__:[0]})])]),f("nav",Se,[b(a,{to:"/auth/login",class:K(["text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium",{"text-indigo-600 border-b-2 border-indigo-600":s.$route.name==="Login"}])},{default:q(()=>n[1]||(n[1]=[D(" Iniciar sesión ")])),_:1,__:[1]},8,["class"]),b(a,{to:"/auth/register",class:K(["text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium",{"text-indigo-600 border-b-2 border-indigo-600":s.$route.name==="Register"}])},{default:q(()=>n[2]||(n[2]=[D(" Crear cuenta ")])),_:1,__:[2]},8,["class"])])])])]),f("main",Ie,[f("div",Pe,[f("div",be,[f("div",Ce,[f("h2",Le,z(r.value),1),o.value?(U(),N("p",je,z(o.value),1)):ce("",!0)]),b(d)])])]),f("footer",Fe,[f("div",Oe,[f("p",qe," © "+z(new Date().getFullYear())+" ZEUS-IA. Todos los derechos reservados. ",1)])])])}}},De=re(ze,[["__scopeId","data-v-5a920ff8"]]),Y=e=>e==null?"":encodeURIComponent(String(e)).replace(/%2F/g,"/").replace(/%20/g,"+").replace(/_/g,"%20"),X=e=>e==null?"":decodeURIComponent(String(e).replace(/\+/g," ")),Ne=()=>k(()=>import("./Dashboard-c4ce7847.js"),["assets/js/Dashboard-c4ce7847.js","assets/js/vendor-b50a21e2.js","assets/js/WebSocketService-6913662e.js","assets/js/zues-3d-main-20ced1d3.js","assets/css/Dashboard-8e13d5bc.css"]),$e=()=>k(()=>import("./OlymposDashboard-f11f9b84.js"),["assets/js/OlymposDashboard-f11f9b84.js","assets/js/vendor-b50a21e2.js","assets/js/zues-3d-main-20ced1d3.js","assets/css/OlymposDashboard-f5cf6ae8.css"]),Ue=()=>k(()=>import("./ZeusCore-deeff988.js"),["assets/js/ZeusCore-deeff988.js","assets/js/vendor-b50a21e2.js","assets/js/three-c4693b27.js","assets/css/ZeusCore-661531f8.css"]),Ve=()=>k(()=>import("./Login-faaaa859.js"),["assets/js/Login-faaaa859.js","assets/js/vendor-b50a21e2.js"]),Be=()=>k(()=>import("./Register-ba45b1e9.js"),["assets/js/Register-ba45b1e9.js","assets/js/vendor-b50a21e2.js","assets/css/Register-e3b0c442.css"]),Me=()=>k(()=>import("./ForgotPassword-92952190.js"),["assets/js/ForgotPassword-92952190.js","assets/js/vendor-b50a21e2.js","assets/css/Register-e3b0c442.css"]),Ke=()=>k(()=>import("./ResetPassword-48dec188.js"),["assets/js/ResetPassword-48dec188.js","assets/js/vendor-b50a21e2.js","assets/css/Register-e3b0c442.css"]),Ze=()=>k(()=>import("./NotFound-6853c9ff.js"),["assets/js/NotFound-6853c9ff.js","assets/js/vendor-b50a21e2.js","assets/css/Register-e3b0c442.css"]),He=()=>k(()=>import("./AuthTest-1c7b6c8e.js"),["assets/js/AuthTest-1c7b6c8e.js","assets/js/vendor-b50a21e2.js"]),We=["AuthLogin","Register","ForgotPassword","ResetPassword","NotFound","AuthTest","WebSocketTest"],V=le({history:de("/"),scrollBehavior(e,t,r){return r||(e.hash?{el:e.hash,behavior:"smooth"}:{top:0,behavior:"smooth"})},stringifyQuery(e){const t=Object.keys(e).sort().map(r=>{const o=e[r];return o==null?"":`${Y(r)}=${Y(String(o))}`}).filter(Boolean).join("&");return t?`?${t}`:""},parseQuery(e){const t={};if(e=e.replace(/^\?/,""),!e)return t;for(const r of e.split("&")){const[o,s]=r.split("=");o&&(t[X(o)]=s?X(s):"")}return t},routes:[{path:"/",redirect:()=>te().isAuthenticated?"/dashboard":"/auth/login"},{path:"/dashboard",name:"Dashboard",component:$e,meta:{title:"El Olimpo - Panel de Zeus",requiresAuth:!0}},{path:"/login",redirect:{name:"AuthLogin"}},{path:"/auth",component:De,children:[{path:"login",name:"AuthLogin",component:Ve,meta:{title:"Iniciar sesión"}},{path:"register",name:"Register",component:Be,meta:{title:"Crear cuenta"}},{path:"forgot-password",name:"ForgotPassword",component:Me,meta:{title:"Recuperar contraseña"}},{path:"reset-password/:token",name:"ResetPassword",component:Ke,meta:{title:"Restablecer contraseña"},props:!0},{path:"",redirect:{name:"AuthLogin"}}]},{path:"/dashboard",name:"DashboardProtected",component:Ne,meta:{title:"Panel de control",requiresAuth:!0}},{path:"/zeus-core",name:"ZeusCore",component:Ue,meta:{title:"Núcleo ZEUS-IA",requiresAuth:!0}},{path:"/auth-test",name:"AuthTest",component:He,meta:{title:"Prueba de Autenticación",requiresAuth:!1}},{path:"/websocket-test",name:"WebSocketTest",component:()=>k(()=>import("./WebSocketTest-1af83779.js"),["assets/js/WebSocketTest-1af83779.js","assets/js/WebSocketService-6913662e.js","assets/js/vendor-b50a21e2.js","assets/css/WebSocketTest-3c8ca337.css"]),meta:{title:"Prueba de WebSocket",requiresAuth:!0}},{path:"/:pathMatch(.*)*",name:"NotFound",component:Ze,meta:{title:"Página no encontrada"}}]});V.beforeEach((e,t,r)=>{const o={};for(const[a,d]of Object.entries(e.params))typeof d=="string"?o[a]=decodeURIComponent(d):Array.isArray(d)?o[a]=d.map(p=>typeof p=="string"?decodeURIComponent(p):p):o[a]=d;if(JSON.stringify(o)!==JSON.stringify(e.params))return r({...e,params:o,hash:e.hash,query:e.query});const s=te(),n=e.matched.some(a=>a.meta.requiresAuth);if(document.title=e.meta.title?`${e.meta.title} | ZEUS-IA`:"ZEUS-IA",n&&!s.isAuthenticated){r({name:"AuthLogin",query:{redirect:e.fullPath}});return}if(s.isAuthenticated&&We.includes(e.name)){const a=e.query.redirect||"/dashboard";r(a);return}r()});V.onError(e=>{});const Ye={id:"app"},Xe=he({__name:"App",setup(e){return(t,r)=>{const o=$("RouterView");return U(),N("div",Ye,[b(o)])}}});const Je=re(Xe,[["__scopeId","data-v-f952a018"]]),Qe=fe(),B=me(Je);B.use(Qe);B.use(V);requestAnimationFrame(()=>{B.mount("#app")});export{re as _,te as u};
