import{r as S,a as ae,i as J,d as ie,c as L,j as O,b as N,e as p,f as b,w as q,n as K,t as z,g as ce,u as ue,h as $,o as U,k as D,l as le,m as de,p as he,q as fe,s as me,v as pe}from"./vendor-3006873b.js";const _e=function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),we=function(e){return"/"+e},Z={},g=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=we(n),n in Z)return;Z[n]=!0;const u=n.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(!!o)for(let m=s.length-1;m>=0;m--){const v=s[m];if(v.href===n&&(!u||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":_e,u||(f.as="script",f.crossOrigin=""),f.href=n,document.head.appendChild(f),u)return new Promise((m,v)=>{f.addEventListener("load",m),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t()).catch(n=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=n,window.dispatchEvent(u),!u.defaultPrevented)throw n})},ke=e=>{if(!e||typeof e!="string"||e.trim()==="")return null;const t=ge(e);if(!t)return null;try{const r=t.split(".");if(r.length!==3)return null;const o=r[1],n=o.padEnd(o.length+(4-o.length%4)%4,"=").replace(/\-/g,"+").replace(/_/g,"/");try{const u=decodeURIComponent(atob(n).split("").map(h=>"%"+("00"+h.charCodeAt(0).toString(16)).slice(-2)).join("")),l=JSON.parse(u);if(l&&typeof l=="object"&&"exp"in l){const h=l.exp}return l}catch{return null}}catch{return null}};S(!1);const ge=e=>{if(!e)return null;try{let t=String(e).replace(/[\u0000-\u001F\u007F-\u009F\u2000-\u200F\u2028-\u202F\u205F-\u206F\u3000\uFEFF]/g,"").trim();if(t=t.replace(/^[^a-zA-Z0-9]*bearer[^a-zA-Z0-9]*(.*)/i,(o,s)=>s||"").trim(),!t)return null;const r=t.split(".");if(r.length!==3)return null;try{r.forEach(o=>{const s=o.padEnd(o.length+(4-o.length%4)%4,"=");atob(s)})}catch{return null}return t}catch{return null}},x="auth_token",I="refresh_token",H="refresh_timeout",j="Bearer ",c={setToken:e=>{if(e)try{localStorage.setItem(x,e),d.defaults.headers.common.Authorization=`${j}${e}`}catch{}else localStorage.removeItem(x),delete d.defaults.headers.common.Authorization},getToken:()=>typeof window>"u"?null:localStorage.getItem(x),setRefreshToken:e=>{if(e)try{localStorage.setItem(I,e)}catch{}else localStorage.removeItem(I)},getRefreshToken:()=>typeof window>"u"?null:localStorage.getItem(I),removeTokens:()=>{localStorage.removeItem(x),localStorage.removeItem(I),localStorage.removeItem(H),delete d.defaults.headers.common.Authorization,window.tokenRefreshTimeout&&(clearTimeout(window.tokenRefreshTimeout),delete window.tokenRefreshTimeout)},removeToken:()=>{localStorage.removeItem(x),delete d.defaults.headers.common.Authorization},isTokenExpired:e=>{if(!e)return!0;try{const t=ke(e);if(!t?.exp)return!0;const r=Date.now()/1e3;return t.exp<r}catch{return!0}},isValidToken:e=>e?e.split(".").length===3&&!c.isTokenExpired(e):!1,clearTokens:()=>{localStorage.removeItem(x),localStorage.removeItem(I),localStorage.removeItem(H),delete d.defaults.headers.common.Authorization,window.tokenRefreshTimeout&&(clearTimeout(window.tokenRefreshTimeout),delete window.tokenRefreshTimeout)},getTokenPayload:e=>{if(!e)return null;try{const t=e.split(".");if(t.length!==3)return null;const r=t[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(r).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch{return null}},refreshToken:function(){throw new Error("Function not implemented.")}},d=ae.create({baseURL:"https://zeus-ia-production-16d8.up.railway.app/api/v1",timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"});d.interceptors.request.use(e=>{const t=c.getToken();return t&&(e.headers.Authorization=`${j}${t}`),e.headers["Access-Control-Allow-Origin"]=window.location.origin,e.headers["Access-Control-Allow-Methods"]="GET, POST, PUT, DELETE, OPTIONS",e.headers["Access-Control-Allow-Headers"]="Content-Type, Authorization, X-Requested-With",e.method?.toLowerCase()==="options"&&(e.headers["Access-Control-Max-Age"]="86400"),e},e=>Promise.reject(e));d.interceptors.request.use(e=>{const t=e.url?.includes("auth/login")||e.url?.includes("auth/refresh-token"),r=c.getToken();return r&&!t&&(e.headers.Authorization=`Bearer ${r}`),e.method?.toLowerCase()==="get"&&(e.params={...e.params,_t:Date.now()}),e},e=>Promise.reject(e));const ve=async()=>{const e=c.getRefreshToken();if(!e)return c.clearTokens(),!1;try{const t=await d.post("auth/refresh-token",{refresh_token:e},{skipAuthRefresh:!0});if(t.data.status==="success"&&t.data.data){const{access_token:r,refresh_token:o}=t.data.data;return c.setToken(r),o&&c.setRefreshToken(o),!0}return!1}catch{return c.clearTokens(),!1}};d.interceptors.response.use(e=>e,async e=>{const t=e.config;if(!e.response)return Promise.reject(_("network_error","Error de red",e));if(e.response?.status!==401||t._retry)return Promise.reject(e);if(t._retry=!0,await ve()){const o=c.getToken();if(o)return t.headers.Authorization=`Bearer ${o}`,d(t)}return Promise.reject(e)});const Q=e=>{if(window.tokenRefreshTimeout!==void 0){const r=window.tokenRefreshTimeout;clearTimeout(r),window.tokenRefreshTimeout=void 0}const t=Math.max(e-300,60)*1e3;window.tokenRefreshTimeout=window.setTimeout(async()=>{try{const r=c.getRefreshToken();r?await ee.refreshToken(r):c.removeTokens()}catch{c.removeTokens(),window.dispatchEvent(new Event("unauthorized"))}},t)},G=async e=>{if(!e)throw new Error("No refresh token provided");try{const t=await d.post("auth/refresh-token",{refresh_token:e},{skipAuthRefresh:!0});if(t.data.status==="success"&&t.data.data){const{access_token:r,refresh_token:o,expires_in:s}=t.data.data;if(c.setToken(r),o&&c.setRefreshToken(o),s){const n=Math.max(s-300,60);Q(n)}return t.data.data}throw new Error(t.data.error||"Failed to refresh token")}catch(t){throw J(t)&&t.response?.status===401&&(c.removeTokens(),window.dispatchEvent(new Event("unauthorized"))),t}};d.interceptors.request.use(e=>{if(e.url?.includes("auth/"))return e;const t=c.getToken();return t&&(e.headers.Authorization=`${j}${t}`),e.method?.toLowerCase()==="get"&&(e.params={...e.params,_t:Date.now()}),e},e=>Promise.reject(e));d.interceptors.response.use(e=>(e.config.url?.includes("auth/"),e),async e=>{const t=e.config;if(!e.response)return Promise.reject(_("network_error","Network error",e));const{status:r,data:o}=e.response;if(r===401&&!t._retry){if(t.url?.includes("auth/login")||t.url?.includes("auth/refresh-token"))return Promise.reject(_("auth_error","Invalid credentials",e,o));t._retry=!0;try{const s=c.getRefreshToken();if(!s)return c.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(_("no_refresh_token","Session expired",e));try{const n=await G(s);if(n.access_token)return t.headers=t.headers||{},t.headers.Authorization=`${j}${n.access_token}`,d(t)}catch(n){return c.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(_("token_refresh_failed","Session refresh failed",n))}}catch(s){return c.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(_("token_refresh_failed","Session refresh failed",s))}}switch(r){case 400:return Promise.reject(_("bad_request","Bad request",e,o));case 403:return c.removeTokens(),window.dispatchEvent(new Event("unauthorized")),Promise.reject(_("forbidden","Forbidden",e,o));case 404:return Promise.reject(_("not_found","Resource not found",e,o));case 422:return Promise.reject(_("validation_error","Validation error",e,o));case 429:return Promise.reject(_("too_many_requests","Too many requests",e,o));case 500:return Promise.reject(_("server_error","Internal server error",e,o));case 503:return Promise.reject(_("service_unavailable","Service unavailable",e,o));default:return Promise.reject(_("api_error","API request failed",e,o))}});const ee={login:async e=>{const t=new FormData;t.append("username",e.username),t.append("password",e.password),t.append("grant_type","password");const r=await d.post("auth/login",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(r.data&&r.data.access_token){const{access_token:o,refresh_token:s,expires_in:n}=r.data;if(c.setToken(o),s&&c.setRefreshToken(s),n){const u=Math.max(n-300,60);Q(u)}return r.data}throw new Error(r.data?.detail||"Login failed")},logout:async()=>{try{const e=c.getRefreshToken();e&&await d.post("auth/logout",{refresh_token:e})}catch{}finally{c.removeTokens(),window.location.href="/login"}},refreshToken:G,getCurrentUser:async()=>{const e=await d.get("auth/me");if(e.data&&e.data.data)return e.data.data;throw new Error(e.data?.detail||"Failed to fetch user profile")},getSystemStatus:async()=>{const e=await d.get("/system/status");if(e.data.status==="success"&&e.data.data)return e.data.data;throw new Error(e.data.error||"Failed to fetch system status")},request:async e=>{const t=await d.request(e);if(t.data.status==="success")return t.data.data;throw new Error(t.data.error||"API request failed")}};function _(e,t,r,o){const s=new Error(t);return s.code=e,s.originalError=r,s.details=o,J(r)&&(s.status=r.response?.status,s.statusText=r.response?.statusText),s}const P="auth_token",C="refresh_token",Te=e=>"error"in e||"detail"in e,W=e=>"access_token"in e,y=ee,te=ie("auth",()=>{const e=S(localStorage.getItem(P)),t=S(localStorage.getItem(C)),r=S(null),o=S(!1),s=S(null),n=L(()=>!!e.value),u=L(()=>!!r.value?.is_superuser);function l(){return e.value||localStorage.getItem(P)}function h(){return t.value||localStorage.getItem(C)}function f(a){try{if(!a.access_token||!a.refresh_token)throw new Error("Invalid tokens provided");return e.value=a.access_token,t.value=a.refresh_token,localStorage.setItem(P,a.access_token),localStorage.setItem(C,a.refresh_token),y.setAuthToken&&y.setAuthToken(a.access_token),!0}catch{return m(),!1}}function m(){e.value=null,t.value=null,r.value=null,s.value=null,localStorage.removeItem(P),localStorage.removeItem(C)}function v(a){try{if(!a)return!1;const i=O(a);return r.value={id:i.sub,email:i.email||"",name:i.name||"User",is_active:i.is_active||!1,is_superuser:i.is_superuser||!1},!0}catch{return m(),!1}}async function oe(a,i){if(o.value=!0,s.value=null,m(),!a||!i)return o.value=!1,{success:!1,error:"Email and password are required"};try{if(typeof localStorage>"u")throw new Error("localStorage is not available");const T="__auth_test__";try{localStorage.setItem(T,"test"),localStorage.removeItem(T)}catch{throw new Error("Could not access local storage")}const w=await y.login({username:a.trim(),password:i});if(Te(w)){const k=w.error||w.detail||"Credenciales inválidas";throw new Error(k)}if(!W(w)){const k="Formato de respuesta inválido";throw new Error(k)}if(!w||typeof w!="object"){const k="Invalid server response format";throw new Error(k)}if(!W(w)){const k="Invalid response format: missing access_token";throw new Error(k)}const A=w;try{const k=O(A.access_token),R={access_token:A.access_token,refresh_token:A.refresh_token||"",expires_in:A.expires_in||3600,token_type:A.token_type||"Bearer"};if(R.refresh_token,!f(R))throw new Error("Failed to save tokens");if(v(R.access_token),!localStorage.getItem(P))throw new Error("Could not verify saved token");return{success:!0,message:"Login successful",access_token:R.access_token,refresh_token:R.refresh_token,expires_in:R.expires_in}}catch{throw m(),new Error("Invalid or corrupted token")}}catch(T){const w=T.message||"Login failed";return s.value=w,m(),{success:!1,error:w}}finally{o.value=!1}}async function M(){try{if(e.value)try{await y.logout()}catch{}m()}catch(a){throw m(),a}}async function se(){const a=h();if(!a||o.value)return!1;o.value=!0;try{const i=await y.refreshToken(a);if(i.access_token){if(!f({access_token:i.access_token,refresh_token:i.refresh_token||a,expires_in:i.expires_in,token_type:i.token_type||"Bearer"}))throw new Error("Failed to update tokens after refresh");return v(i.access_token),!0}else throw new Error("Invalid token refresh response")}catch(i){return i instanceof Error&&(i.message.includes("401")||i.message.includes("invalid_grant")||i.message.includes("invalid_token")||i.message.includes("Network error"))&&await M(),!1}finally{o.value=!1}}let F=!1,E=!1;async function ne(){if(E)return n.value;if(F)return!1;F=!0;try{const a=l(),i=h();if(!a||!i)return E=!0,!1;y.setAuthToken&&y.setAuthToken(a);const T=O(a),w=Math.floor(Date.now()/1e3);if(T.exp?T.exp<w:!0)return m(),E=!0,!1;e.value=a,t.value=i;try{return v(a),E=!0,!0}catch{return E=!0,!0}}catch{return E=!0,!1}finally{F=!1}}return{token:e,refreshToken:t,user:r,isLoading:o,error:s,isAuthenticated:n,isAdmin:u,login:oe,logout:M,initialize:ne,refreshAccessToken:se,resetAuthState:m,getToken:l,getRefreshToken:h,updateUserFromToken:v,setAuthTokens:f}});const re=(e,t)=>{const r=e.__vccOpts||e;for(const[o,s]of t)r[o]=s;return r},ye={class:"min-h-screen flex flex-col bg-gray-50"},Ee={class:"bg-white shadow-sm"},Ae={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Re={class:"flex justify-between items-center"},xe={class:"flex-shrink-0"},Se={class:"text-2xl font-bold text-indigo-600"},Ie={class:"hidden md:flex space-x-8"},Pe={class:"flex-grow flex items-center justify-center p-4"},be={class:"w-full max-w-md"},Ce={class:"bg-white p-8 rounded-lg shadow-md"},Le={class:"text-center mb-8"},je={class:"text-2xl font-bold text-gray-900"},Fe={key:0,class:"mt-2 text-sm text-gray-600"},Oe={class:"bg-white border-t border-gray-200"},qe={class:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},ze={class:"text-center text-sm text-gray-500"},De={__name:"AuthLayout",setup(e){const t=ue(),r=L(()=>t.meta.title||"Bienvenido a ZEUS-IA"),o=L(()=>t.meta.description||"");return(s,n)=>{const u=$("router-link"),l=$("router-view");return U(),N("div",ye,[p("header",Ee,[p("div",Ae,[p("div",Re,[p("div",xe,[p("h1",Se,[b(u,{to:"/"},{default:q(()=>n[0]||(n[0]=[D("ZEUS-IA")])),_:1,__:[0]})])]),p("nav",Ie,[b(u,{to:"/auth/login",class:K(["text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium",{"text-indigo-600 border-b-2 border-indigo-600":s.$route.name==="Login"}])},{default:q(()=>n[1]||(n[1]=[D(" Iniciar sesión ")])),_:1,__:[1]},8,["class"]),b(u,{to:"/auth/register",class:K(["text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium",{"text-indigo-600 border-b-2 border-indigo-600":s.$route.name==="Register"}])},{default:q(()=>n[2]||(n[2]=[D(" Crear cuenta ")])),_:1,__:[2]},8,["class"])])])])]),p("main",Pe,[p("div",be,[p("div",Ce,[p("div",Le,[p("h2",je,z(r.value),1),o.value?(U(),N("p",Fe,z(o.value),1)):ce("",!0)]),b(l)])])]),p("footer",Oe,[p("div",qe,[p("p",ze," © "+z(new Date().getFullYear())+" ZEUS-IA. Todos los derechos reservados. ",1)])])])}}},Ne=re(De,[["__scopeId","data-v-5a920ff8"]]),Y=e=>e==null?"":encodeURIComponent(String(e)).replace(/%2F/g,"/").replace(/%20/g,"+").replace(/_/g,"%20"),X=e=>e==null?"":decodeURIComponent(String(e).replace(/\+/g," ")),$e=()=>g(()=>import("./Dashboard-0e202c80.js"),["assets/js/Dashboard-0e202c80.js","assets/js/vendor-3006873b.js","assets/js/WebSocketService-ef50ade1.js","assets/js/zues-3d-main-20ced1d3.js","assets/css/Dashboard-8e13d5bc.css"]),Ue=()=>g(()=>import("./OlymposDashboard-9b6ea325.js"),["assets/js/OlymposDashboard-9b6ea325.js","assets/js/vendor-3006873b.js","assets/js/zues-3d-main-20ced1d3.js","assets/css/OlymposDashboard-38b1d37f.css"]),Ve=()=>g(()=>import("./ZeusCore-5a48898f.js"),["assets/js/ZeusCore-5a48898f.js","assets/js/vendor-3006873b.js","assets/js/three-c4693b27.js","assets/css/ZeusCore-661531f8.css"]),Be=()=>g(()=>import("./Login-99b38fcc.js"),["assets/js/Login-99b38fcc.js","assets/js/vendor-3006873b.js"]),Me=()=>g(()=>import("./Register-c00cc57d.js"),["assets/js/Register-c00cc57d.js","assets/js/vendor-3006873b.js","assets/css/Register-e3b0c442.css"]),Ke=()=>g(()=>import("./ForgotPassword-3d253829.js"),["assets/js/ForgotPassword-3d253829.js","assets/js/vendor-3006873b.js","assets/css/Register-e3b0c442.css"]),Ze=()=>g(()=>import("./ResetPassword-cc429124.js"),["assets/js/ResetPassword-cc429124.js","assets/js/vendor-3006873b.js","assets/css/Register-e3b0c442.css"]),He=()=>g(()=>import("./NotFound-db7a3b83.js"),["assets/js/NotFound-db7a3b83.js","assets/js/vendor-3006873b.js","assets/css/Register-e3b0c442.css"]),We=()=>g(()=>import("./AuthTest-fc87296f.js"),["assets/js/AuthTest-fc87296f.js","assets/js/vendor-3006873b.js"]),Ye=["AuthLogin","Register","ForgotPassword","ResetPassword","NotFound","AuthTest","WebSocketTest"],V=le({history:de("/"),scrollBehavior(e,t,r){return r||(e.hash?{el:e.hash,behavior:"smooth"}:{top:0,behavior:"smooth"})},stringifyQuery(e){const t=Object.keys(e).sort().map(r=>{const o=e[r];return o==null?"":`${Y(r)}=${Y(String(o))}`}).filter(Boolean).join("&");return t?`?${t}`:""},parseQuery(e){const t={};if(e=e.replace(/^\?/,""),!e)return t;for(const r of e.split("&")){const[o,s]=r.split("=");o&&(t[X(o)]=s?X(s):"")}return t},routes:[{path:"/",name:"Dashboard",component:Ue,meta:{title:"El Olimpo - Panel de Zeus",requiresAuth:!0}},{path:"/login",redirect:{name:"AuthLogin"}},{path:"/auth",component:Ne,children:[{path:"login",name:"AuthLogin",component:Be,meta:{title:"Iniciar sesión"}},{path:"register",name:"Register",component:Me,meta:{title:"Crear cuenta"}},{path:"forgot-password",name:"ForgotPassword",component:Ke,meta:{title:"Recuperar contraseña"}},{path:"reset-password/:token",name:"ResetPassword",component:Ze,meta:{title:"Restablecer contraseña"},props:!0},{path:"",redirect:{name:"AuthLogin"}}]},{path:"/dashboard",name:"DashboardProtected",component:$e,meta:{title:"Panel de control",requiresAuth:!0}},{path:"/zeus-core",name:"ZeusCore",component:Ve,meta:{title:"Núcleo ZEUS-IA",requiresAuth:!0}},{path:"/auth-test",name:"AuthTest",component:We,meta:{title:"Prueba de Autenticación",requiresAuth:!1}},{path:"/websocket-test",name:"WebSocketTest",component:()=>g(()=>import("./WebSocketTest-d780b667.js"),["assets/js/WebSocketTest-d780b667.js","assets/js/WebSocketService-ef50ade1.js","assets/js/vendor-3006873b.js","assets/css/WebSocketTest-3c8ca337.css"]),meta:{title:"Prueba de WebSocket",requiresAuth:!0}},{path:"/:pathMatch(.*)*",name:"NotFound",component:He,meta:{title:"Página no encontrada"}}]});V.beforeEach((e,t,r)=>{const o={};for(const[l,h]of Object.entries(e.params))typeof h=="string"?o[l]=decodeURIComponent(h):Array.isArray(h)?o[l]=h.map(f=>typeof f=="string"?decodeURIComponent(f):f):o[l]=h;if(JSON.stringify(o)!==JSON.stringify(e.params))return r({...e,params:o,hash:e.hash,query:e.query});const n=te().isAuthenticated,u=e.matched.some(l=>l.meta.requiresAuth);if(document.title=e.meta.title?`${e.meta.title} | ZEUS-IA`:"ZEUS-IA",u&&!n)r({name:"AuthLogin",query:{redirect:e.fullPath}});else if(n&&Ye.includes(e.name)){const l=e.query.redirect||"/dashboard";window.location.href=l;return}else r()});V.onError(e=>{});const Xe={id:"app"},Je=he({__name:"App",setup(e){const t=te();let r=!1;return fe(()=>{r||(Promise.resolve().then(async()=>{try{await t.initialize()}catch{}}),r=!0)}),(o,s)=>{const n=$("RouterView");return U(),N("div",Xe,[b(n)])}}});const Qe=re(Je,[["__scopeId","data-v-4507c7d3"]]),Ge=me(),B=pe(Qe);B.use(Ge);B.use(V);B.mount("#app");export{re as _,te as u};
